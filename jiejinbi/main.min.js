var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function s(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?s(o):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){var e=new Gold.GameContainer;this.addChild(e)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,s){function o(e){t.call(s,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Gold;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.stageW=1280,e.stageH=720,e.myScore=0,e.myHp=3,e.goldTimer=new egret.Timer(500),e.golds=[],e.bombs=[],e.gameTimer=new egret.Timer(1e3),e.gameAllTime=30,e.bombCount=0,e._lastTime=egret.getTimer(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(i,t),i.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},i.prototype.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.bg=this.bg||new eui.Image("gameBg_jpg"),this.bg.width=this.stageW,this.bg.height=this.stageH,this.addChild(this.bg),this.player=this.player||new eui.Image("player_png"),this.player.width=160,this.player.height=200,this.player.x=(this.stageW-this.player.width)/2,this.player.y=this.stageH-this.player.height,this.player.touchEnabled=!1,this.addChild(this.player),this.btnStart=this.btnStart||new eui.Image("beginBtn_png"),this.btnStart.width=177,this.btnStart.height=59,this.btnStart.x=(this.stageW-this.btnStart.width)/2,this.btnStart.y=(this.stageH-this.btnStart.height)/2,this.btnStart.touchEnabled=!0,this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this),this.addChild(this.btnStart),this.score=this.score||new eui.Label("得分：0"),this.score.x=this.stageW-200,this.score.textColor=0,this.addChild(this.score),this.hp=this.hp||new eui.Label("生命值：3"),this.hp.textColor=0,this.addChild(this.hp),this.timesDisplay=this.timesDisplay||new eui.Label("倒计时：30"),this.timesDisplay.textColor=0,this.timesDisplay.x=(this.stageW-this.timesDisplay.width)/2,this.addChild(this.timesDisplay),this.gameOverDisplay=this.gameOverDisplay||new eui.Label("您的成绩是:0 ，再来一次吧！"),this.gameOverDisplay.y=200,this.gameOverDisplay.size=45,this.gameOverDisplay.textColor=16711680},i.prototype.gameStart=function(){this.myScore=0,this.myHp=3,this.gameAllTime=30,this.score.text="得分："+this.myScore,this.timesDisplay.text="倒计时："+this.gameAllTime,this.hp.text="生命值："+this.myHp,this.player.x=(this.stageW-this.player.width)/2,this.btnStart.visible=!1,this.gameOverDisplay.parent==this&&this.removeChild(this.gameOverDisplay),this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onPlayerBegin,this),this.bg.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onPlayerMove,this),this.goldTimer.addEventListener(egret.TimerEvent.TIMER,this.createGold,this),this.goldTimer.start(),this.gameTimer.addEventListener(egret.TimerEvent.TIMER,this.onStartGameTimes,this),this.gameTimer.start()},i.prototype.onStartGameTimes=function(){return this.gameAllTime<=0?void this.gameOver():(this.gameAllTime--,void(this.timesDisplay.text="倒计时："+this.gameAllTime))},i.prototype.gameOver=function(){this.btnStart.visible=!0,this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onPlayerBegin,this),this.bg.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onPlayerMove,this),this.goldTimer.removeEventListener(egret.TimerEvent.TIMER,this.createGold,this),this.goldTimer.stop(),this.gameTimer.removeEventListener(egret.TimerEvent.TIMER,this.onStartGameTimes,this),this.gameTimer.stop();for(var t;this.golds.length>0;)t=this.golds.pop(),this.removeChild(t),e.GoldPool.recovery(t);for(var i;this.bombs.length>0;)i=this.bombs.pop(),this.removeChild(i),e.GoldPool.recovery(i);this.gameOverDisplay.text="您的成绩是: "+this.myScore+"，再来一次吧！",this.gameOverDisplay.x=(this.stageW-this.gameOverDisplay.width)/2,this.getChildIndex(this.gameOverDisplay)<0&&this.addChild(this.gameOverDisplay)},i.prototype.gameViewUpdate=function(){var t=egret.getTimer(),i=1e3/(t-this._lastTime);this._lastTime=t;for(var s,o=60/i,r=this.golds.length,h=0;r>h;h++)s=this.golds[h],s.y>this.stage.stageHeight&&(this.removeChild(s),e.GoldPool.recovery(s),this.golds.splice(h,1),h--,r--),s.y+=8*o;for(var n,a=this.bombs.length,l=0;a>l;l++)n=this.bombs[l],n.y>this.stage.stageHeight&&(this.removeChild(n),e.GoldPool.recovery(n),this.bombs.splice(l,1),l--,a--),n.y+=9*o;this.hitJudge()},i.prototype.hitJudge=function(){for(var t,i=this.golds.length,s=[],o=0;i>o;o++)t=this.golds[o],e.Util.collision(this.player,t)&&-1==s.indexOf(t)&&s.push(t);for(var r,h=[],n=this.bombs.length,a=0;n>a;a++)r=this.bombs[a],e.Util.collision(this.player,r)&&(this.myHp--,this.hp.text="生命值："+this.myHp,-1==h.indexOf(r)&&h.push(r));if(this.myHp<=0)this.gameOver();else{for(this.myScore+=s.length;s.length>0;)t=s.pop(),this.removeChild(t),this.golds.splice(this.golds.indexOf(t),1),e.GoldPool.recovery(t);for(this.score.text="得分："+this.myScore;h.length>0;)r=h.pop(),this.removeChild(r),this.bombs.splice(this.bombs.indexOf(r),1),e.GoldPool.recovery(r)}},i.prototype.createGold=function(t){var i=e.GoldPool.produce("gold");if(i.x=Math.random()*(this.stageW-i.width),i.y=-i.height,this.addChildAt(i,this.numChildren-1),this.golds.push(i),this.bombCount++,this.bombCount>=2){this.bombCount=0;var s=e.GoldPool.produce("bomb");s.x=Math.random()*(this.stageW-s.width),s.y=-s.height,this.addChildAt(s,this.numChildren-1),this.bombs.push(s)}},i.prototype.onPlayerBegin=function(e){this.lastX=e.stageX},i.prototype.onPlayerMove=function(e){var t=e.stageX-this.lastX;this.player.x+=t,this.lastX=e.stageX,this.player.x<0?this.player.x=0:this.player.x>this.stageW-this.player.width&&(this.player.x=this.stageW-this.player.width)},i}(egret.DisplayObjectContainer);e.GameContainer=t,__reflect(t.prototype,"Gold.GameContainer")}(Gold||(Gold={}));var Gold;!function(e){var t=function(t){function i(e,i){var s=t.call(this,e+"_png")||this;return s.textureName=i,s}return __extends(i,t),i.produce=function(t){this.cacheDict[t]||(this.cacheDict[t]=[]);var i=this.cacheDict[t],s=null;return s=i.length>0?i.pop():new e.GoldPool(t,t)},i.recovery=function(e){var t=e.textureName;this.cacheDict[t]||(this.cacheDict[t]=[]);var i=this.cacheDict[t];-1==i.indexOf(e)&&i.push(e)},i.cacheDict={},i}(eui.Image);e.GoldPool=t,__reflect(t.prototype,"Gold.GoldPool")}(Gold||(Gold={}));var Gold;!function(e){var t=function(){function e(){}return e.collision=function(e,t){var i=e.getBounds(),s=t.getBounds();return i.x=e.x,i.y=e.y,s.x=t.x,s.y=t.y,i.intersects(s)},e}();e.Util=t,__reflect(t.prototype,"Gold.Util")}(Gold||(Gold={}));